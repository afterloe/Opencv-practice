# 综合分析与技能回顾
> create by [afterloe](605728727@qq.com)  
> version is 1.3  
> MIT License  

本节会对之前所用到的知识进行回顾，同时将树莓派中的部分实例进行回顾，大纲如下：
```
   - 二值图像分析运用，缺陷检测
   - 最大轮廓提取
   - 图像水印去除与修复
   - 图像透视变换
   - 视频的读取与色彩追踪
   - 视频前景背景分离与ROI区域提取
```
## 二值图像分析运用，缺陷检测
工业品的缺陷检测是二值图像分析中的经典案例，分为两个部分进行，第一部分是通过图像分析提取指定的轮廓，第二部分是通过对比实现划痕检
测与缺角检测。检测流程如下：
> 输入图像 -> 二值化 -> 轮廓发现与分析 -> 轮廓排序 -> 填充/扩大 -> 模板比对 -> 结果输出

相关代码可以看[1-clazz.py](./1-clazz.py)和[2-clazz.py](./2-clazz.py),关键点在于检测时将ROI区域`resize`到与模板大小一致    

出了缺陷检测，还可以使用思路对对对看中的内容进行提取，算作衍生的练习内容，根据输入图像的类型选择合适的二值化参数,
具体代码可以看[这里](./2-practice.py)

## [最大轮廓提取](./3-clazz.py)
获取二值化后的图像进行轮廓分析，根据面积寻找最大轮廓，然后根据轮廓进行轮廓逼近，获取关键点轮廓点。关键点在于
`cv.approxPolyDP`，该方法，通过拟合的方式将图像拟合城举行，并对关键点进行处理。

## [图像水印去除与修复](./4-clazz.py)
opencv中有时候需要批量去水印，其本质上是一中图像修复，该api如下：
```
cv.inpaint(src, inpaintMask, dst, napaintRaduis, fags)
    - src: 需要修复的图像
    - inpaintMask: 图形遮罩(水印)
    - inpaintRadius: 图像修复半径，半径越小印象越小
    - fags: cv::INPAINT_NS or cv::INPAINT_TELEA
```
去水印的关键是图形遮罩的寻找，最好的方式是找美工将水印抠出来作证模板，然后进行处理即可

## [图像透视变换](./5-clazz.py)
图像透视变换用于修正文本扫描图片时ROI区域倾斜，通过图像透视变换能够获取较好剪切效果。通过图像透视变化的好处如下：  
1 透视变换不会涉及到集合变换角度旋转      
2 透视变换对畸变图像有一定的展开效果（对于鱼眼摄像头，需要获的其摄像头的某些参数才行，否则需要自行编写算法）      
3 透视变换可以完成对图像的ROI区域提取    

关于图像透视变换的api描述如下：
```
图像矫正及剪切获取变换矩阵
cv.findHomography(srcPoints, dstPoints)
    - srcPoints: 原图像
    - dstPoints: 需要剪切的图像
return mat, status -> 剪切的图像，状态

透视变换
cv.warpPerspective(srcPoints, mat, dsize)
    - srcPoints: 原图像
    - mat: 变换矩阵，由findHomography操作后的图像
    - dsize: 矩阵的大小
```
关键点在于*最小外接矩形, 返回三个值 最小矩形的旋转角度、中心点坐标及大小*,根据该信息mask重置。

## 视频读取与色彩追踪
视频读取的算法关键在于FPS，所谓FPS即每秒多少帧的处理能力，一般情况下（人类对300毫秒以下的变动是无法察觉的）每秒大于5帧的处理可以认为是视屏处
理,在Raspberry中，曾做过颜色追踪的示例，本次对该示例进行重构。  
有关视频读取的代码可以看[这里](./6-clazz.py)，有关色彩空间
追踪的代码，可以看[这里](./7-clazz.py)，该示例应用了形态学与最大轮廓的处理，演示了更好的处置效果。

## 视频的前景背景分离与ROI区域提取
视频前景/背景提取技术用于提取前景移动对象，通过获取移动对象的mask实现获取移动物体的轮廓信息，最常用的方法是帧
差相减法进行，即用前一帧的图像最为背景图像与当前帧进行相减，该方法对光照、噪声相当敏感。opencv中对背景模型提取的算法有两种，一种是基于高斯模糊模型（GMM）
实现背景提取，另外一种是使用最近相邻模型（KNN）实现的，api如下：
```
GMM cv.createBackgroundSubtractorMOG2(history, varThreshold, detectShadows)
    - history: 过往帧数，默认500帧，历史进行比较
    - varThreshold: 马氏距离，默认16，值越大，最新的像素会归为前景，值越小对光照敏感
    - detectShadow: 是否保留阴影检测，默认True， 开启阴影检测虽然可以提高提取效果，但是效率会变低，推荐不开启

KNN cv.createBackgroundSubtractorKNN()的参数描述如上
```
示例代码在[这里](./8-clazz.py)    

通过视频中的背景进行建模（GMM、KNN等）实现背景消除，生成mask图像，通过对mask二值图像分析实现对前景活动对象ROI
区域的提取，也是很多视频分析软件常用的手段，其工作原理如下：  
    1 初始化背景建模对象  
    2 读取视屏  
    3 使用背景建模消除生成mask  
    4 对mask进行轮廓分析提取ROI  
    5 绘制ROI对象  
示例代码在[这里](./9-clazz.py)
